{"dependencies":[{"name":"../lib/constants","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":51,"index":51}}],"key":"waQwSI03ELOcvO96++KD0MVyAp4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function(g,r,i,a,m,e,d){\"use strict\";Object.defineProperty(e,'__esModule',{value:!0}),Object.defineProperty(e,\"default\",{enumerable:!0,get:function(){return s}});var t=r(d[0]);class s{constructor(s,h,n={},c=t.DEFAULT_TIMEOUT){this.channel=s,this.event=h,this.payload=n,this.timeout=c,this.sent=!1,this.timeoutTimer=void 0,this.ref='',this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref='',this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived('timeout')||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,s){var h;return this._hasReceived(t)&&s(null===(h=this.receivedResp)||void 0===h?void 0:h.response),this.recHooks.push({status:t,callback:s}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)}),this.timeoutTimer=setTimeout(()=>{this.trigger('timeout',{})},this.timeout)}trigger(t,s){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:s})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:s}){this.recHooks.filter(s=>s.status===t).forEach(t=>t.callback(s))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}});","lineCount":1,"map":[[1,90,2,15,"Object"],[1,97,2,15,"defineProperty"],[1,112,2,15,"e"],[1,114,2,15],[1,125,2,15,"enumerable"],[1,137,2,15],[1,139,2,15,"get"],[1,143,2,15],[1,161,2,15,"Push"],[1,162,2,15],[1,166,1,0],[1,170,1,0,"_libConstants"],[1,172,1,0,"r"],[1,174,1,0,"d"],[1,176,1,0],[1,180,2,15],[1,186,2,21,"Push"],[1,188,11,4,"constructor"],[1,200,11,16,"channel"],[1,202,11,25,"event"],[1,204,11,32,"payload"],[1,206,11,42],[1,207,11,43],[1,209,11,46,"timeout"],[1,211,11,56,"DEFAULT_TIMEOUT"],[1,213,11,71,"DEFAULT_TIMEOUT"],[1,230,12,8,"this"],[1,235,12,13,"channel"],[1,243,12,23,"channel"],[1,245,13,8,"this"],[1,250,13,13,"event"],[1,256,13,21,"event"],[1,258,14,8,"this"],[1,263,14,13,"payload"],[1,271,14,23,"payload"],[1,273,15,8,"this"],[1,278,15,13,"timeout"],[1,286,15,23,"timeout"],[1,288,16,8,"this"],[1,293,16,13,"sent"],[1,299,16,20],[1,301,17,8,"this"],[1,306,17,13,"timeoutTimer"],[1,324,17,28,"undefined"],[1,326,18,8,"this"],[1,331,18,13,"ref"],[1,335,18,19],[1,338,19,8,"this"],[1,343,19,13,"receivedResp"],[1,356,19,28],[1,361,20,8,"this"],[1,366,20,13,"recHooks"],[1,375,20,24],[1,378,21,8,"this"],[1,383,21,13,"refEvent"],[1,392,21,24],[1,396,22,4],[1,397,23,4,"resend"],[1,404,23,11,"timeout"],[1,407,24,8,"this"],[1,412,24,13,"timeout"],[1,420,24,23,"timeout"],[1,422,25,8,"this"],[1,427,25,13,"_cancelRefEvent"],[1,445,26,8,"this"],[1,450,26,13,"ref"],[1,454,26,19],[1,457,27,8,"this"],[1,462,27,13,"refEvent"],[1,471,27,24],[1,476,28,8,"this"],[1,481,28,13,"receivedResp"],[1,494,28,28],[1,499,29,8,"this"],[1,504,29,13,"sent"],[1,510,29,20],[1,512,30,8,"this"],[1,517,30,13,"send"],[1,523,31,4],[1,524,32,4,"send"],[1,531,33,12,"this"],[1,536,33,17,"_hasReceived"],[1,549,33,30],[1,562,36,8,"this"],[1,567,36,13,"startTimeout"],[1,582,37,8,"this"],[1,587,37,13,"sent"],[1,593,37,20],[1,595,38,8,"this"],[1,600,38,13,"channel"],[1,608,38,21,"socket"],[1,615,38,28,"push"],[1,620,38,33],[1,621,39,12,"topic"],[1,627,39,19,"this"],[1,632,39,24,"channel"],[1,640,39,32,"topic"],[1,646,40,12,"event"],[1,652,40,19,"this"],[1,657,40,24,"event"],[1,663,41,12,"payload"],[1,671,41,21,"this"],[1,676,41,26,"payload"],[1,684,42,12,"ref"],[1,688,42,17,"this"],[1,693,42,22,"ref"],[1,697,43,12,"join_ref"],[1,706,43,22,"this"],[1,711,43,27,"channel"],[1,719,43,35,"_joinRef"],[1,732,45,4],[1,733,46,4,"updatePayload"],[1,747,46,18,"payload"],[1,750,47,8,"this"],[1,755,47,13,"payload"],[1,763,47,23,"Object"],[1,770,47,30,"assign"],[1,777,47,37,"Object"],[1,784,47,44,"assign"],[1,791,47,51],[1,792,47,52],[1,794,47,55,"this"],[1,799,47,60,"payload"],[1,808,47,70,"payload"],[1,810,48,4],[1,811,49,4,"receive"],[1,819,49,12,"status"],[1,821,49,20,"callback"],[1,824,50,8],[1,828,50,12,"_a"],[1,830,55,8],[1,837,51,12,"this"],[1,842,51,17,"_hasReceived"],[1,855,51,30,"status"],[1,859,52,12,"callback"],[1,861,52,50],[1,869,52,22,"_a"],[1,871,52,27,"this"],[1,876,52,32,"receivedResp"],[1,896,52,60,"undefined"],[1,900,52,58,"_a"],[1,907,52,71,"undefined"],[1,909,52,83,"_a"],[1,911,52,86,"response"],[1,921,54,8,"this"],[1,926,54,13,"recHooks"],[1,935,54,22,"push"],[1,940,54,27],[1,941,54,29,"status"],[1,950,54,37,"callback"],[1,963,55,15,"this"],[1,967,56,4],[1,968,57,4,"startTimeout"],[1,983,58,8],[1,986,58,12,"this"],[1,991,58,17,"timeoutTimer"],[1,1004,59,12],[1,1011,61,8,"this"],[1,1016,61,13,"ref"],[1,1020,61,19,"this"],[1,1025,61,24,"channel"],[1,1033,61,32,"socket"],[1,1040,61,39,"_makeRef"],[1,1051,62,8,"this"],[1,1056,62,13,"refEvent"],[1,1065,62,24,"this"],[1,1070,62,29,"channel"],[1,1078,62,37,"_replyEventName"],[1,1094,62,53,"this"],[1,1099,62,58,"ref"],[1,1104,69,8,"this"],[1,1109,69,13,"channel"],[1,1117,69,21,"_on"],[1,1121,69,25,"this"],[1,1126,69,30,"refEvent"],[1,1135,69,40],[1,1136,69,41],[1,1138,63,26,"payload"],[1,1142,64,12,"this"],[1,1147,64,17,"_cancelRefEvent"],[1,1165,65,12,"this"],[1,1170,65,17,"_cancelTimeout"],[1,1187,66,12,"this"],[1,1192,66,17,"receivedResp"],[1,1205,66,32,"payload"],[1,1207,67,12,"this"],[1,1212,67,17,"_matchReceive"],[1,1226,67,31,"payload"],[1,1231,70,8,"this"],[1,1236,70,13,"timeoutTimer"],[1,1249,70,28,"setTimeout"],[1,1260,70,39],[1,1265,71,12,"this"],[1,1270,71,17,"trigger"],[1,1278,71,25],[1,1288,71,36],[1,1289,71,37],[1,1293,72,11,"this"],[1,1298,72,16,"timeout"],[1,1306,73,4],[1,1307,74,4,"trigger"],[1,1315,74,12,"status"],[1,1317,74,20,"response"],[1,1320,75,12,"this"],[1,1325,75,17,"refEvent"],[1,1335,76,12,"this"],[1,1340,76,17,"channel"],[1,1348,76,25,"_trigger"],[1,1357,76,34,"this"],[1,1362,76,39,"refEvent"],[1,1371,76,49],[1,1372,76,51,"status"],[1,1381,76,59,"response"],[1,1393,77,4],[1,1394,78,4,"destroy"],[1,1404,79,8,"this"],[1,1409,79,13,"_cancelRefEvent"],[1,1427,80,8,"this"],[1,1432,80,13,"_cancelTimeout"],[1,1448,81,4],[1,1449,82,4,"_cancelRefEvent"],[1,1467,83,13,"this"],[1,1472,83,18,"refEvent"],[1,1482,86,8,"this"],[1,1487,86,13,"channel"],[1,1495,86,21,"_off"],[1,1500,86,26,"this"],[1,1505,86,31,"refEvent"],[1,1514,86,41],[1,1515,86,42],[1,1517,87,4],[1,1518,88,4,"_cancelTimeout"],[1,1535,89,8,"clearTimeout"],[1,1548,89,21,"this"],[1,1553,89,26,"timeoutTimer"],[1,1567,90,8,"this"],[1,1572,90,13,"timeoutTimer"],[1,1590,90,28,"undefined"],[1,1591,91,4],[1,1592,92,4,"_matchReceive"],[1,1607,92,18,"status"],[1,1614,92,20,"status"],[1,1616,92,26,"response"],[1,1625,92,28,"response"],[1,1629,93,8,"this"],[1,1634,93,13,"recHooks"],[1,1643,93,22,"filter"],[1,1650,93,30,"h"],[1,1653,93,36,"h"],[1,1655,93,38,"status"],[1,1664,93,49,"status"],[1,1667,93,57,"forEach"],[1,1675,93,66,"h"],[1,1678,93,72,"h"],[1,1680,93,74,"callback"],[1,1689,93,83,"response"],[1,1692,94,4],[1,1693,95,4,"_hasReceived"],[1,1706,95,17,"status"],[1,1709,96,8],[1,1716,96,15,"this"],[1,1721,96,20,"receivedResp"],[1,1735,96,36,"this"],[1,1740,96,41,"receivedResp"],[1,1753,96,54,"status"],[1,1762,96,65,"status"],[1,1763,97,4],[1,1765,98,1],[1,1768]],"functionMap":{"names":["<global>","Push","Push#constructor","Push#resend","Push#send","Push#updatePayload","Push#receive","Push#startTimeout","callback","setTimeout$argument_0","Push#trigger","Push#destroy","Push#_cancelRefEvent","Push#_cancelTimeout","Push#_matchReceive","recHooks.filter$argument_0","recHooks.filter.forEach$argument_0","Push#_hasReceived"],"mappings":"AAA;eCC;ICS;KDW;IEC;KFQ;IGC;KHa;IIC;KJE;IKC;KLO;IMC;yBCM;SDK;uCEE;SFE;KNC;ISC;KTG;IUC;KVG;IWC;KXK;IYC;KZG;IaC;6BCC,0BD,UE,2BF;KbC;IgBC;KhBE;CDC"},"hasCjsExports":false},"type":"js/module"}]}