{"dependencies":[],"output":[{"data":{"code":"__d(function(g,r,i,a,_m,e,d){\"use strict\";var n;Object.defineProperty(e,'__esModule',{value:!0}),Object.defineProperty(e,\"default\",{enumerable:!0,get:function(){return t}}),Object.defineProperty(e,\"REALTIME_PRESENCE_LISTEN_EVENTS\",{enumerable:!0,get:function(){return n}}),(function(n){n.SYNC=\"sync\",n.JOIN=\"join\",n.LEAVE=\"leave\"})(n||(n={}));class t{constructor(n,s){this.channel=n,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const c=(null==s?void 0:s.events)||{state:'presence_state',diff:'presence_diff'};this.channel._on(c.state,{},n=>{const{onJoin:s,onLeave:c,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=t.syncState(this.state,n,s,c),this.pendingDiffs.forEach(n=>{this.state=t.syncDiff(this.state,n,s,c)}),this.pendingDiffs=[],o()}),this.channel._on(c.diff,{},n=>{const{onJoin:s,onLeave:c,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=t.syncDiff(this.state,n,s,c),o())}),this.onJoin((n,t,s)=>{this.channel._trigger('presence',{event:'join',key:n,currentPresences:t,newPresences:s})}),this.onLeave((n,t,s)=>{this.channel._trigger('presence',{event:'leave',key:n,currentPresences:t,leftPresences:s})}),this.onSync(()=>{this.channel._trigger('presence',{event:'sync'})})}static syncState(n,t,s,c){const o=this.cloneDeep(n),f=this.transformState(t),h={},l={};return this.map(o,(n,t)=>{f[n]||(l[n]=t)}),this.map(f,(n,t)=>{const s=o[n];if(s){const c=t.map(n=>n.presence_ref),o=s.map(n=>n.presence_ref),f=t.filter(n=>o.indexOf(n.presence_ref)<0),p=s.filter(n=>c.indexOf(n.presence_ref)<0);f.length>0&&(h[n]=f),p.length>0&&(l[n]=p)}else h[n]=t}),this.syncDiff(o,{joins:h,leaves:l},s,c)}static syncDiff(n,t,s,c){const{joins:o,leaves:f}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),c||(c=()=>{}),this.map(o,(t,c)=>{var o;const f=null!==(o=n[t])&&void 0!==o?o:[];if(n[t]=this.cloneDeep(c),f.length>0){const s=n[t].map(n=>n.presence_ref),c=f.filter(n=>s.indexOf(n.presence_ref)<0);n[t].unshift(...c)}s(t,f,c)}),this.map(f,(t,s)=>{let o=n[t];if(!o)return;const f=s.map(n=>n.presence_ref);o=o.filter(n=>f.indexOf(n.presence_ref)<0),n[t]=o,c(t,o,s),0===o.length&&delete n[t]}),n}static map(n,t){return Object.getOwnPropertyNames(n).map(s=>t(s,n[s]))}static transformState(n){return n=this.cloneDeep(n),Object.getOwnPropertyNames(n).reduce((t,s)=>{const c=n[s];return t[s]='metas'in c?c.metas.map(n=>(n.presence_ref=n.phx_ref,delete n.phx_ref,delete n.phx_ref_prev,n)):c,t},{})}static cloneDeep(n){return JSON.parse(JSON.stringify(n))}onJoin(n){this.caller.onJoin=n}onLeave(n){this.caller.onLeave=n}onSync(n){this.caller.onSync=n}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}});","lineCount":1,"map":[[1,42,5,7],[1,46,5,11,"REALTIME_PRESENCE_LISTEN_EVENTS"],[1,48],[1,97,11,15,"Object"],[1,104,11,15,"defineProperty"],[1,119,11,15,"e"],[1,121,11,15],[1,132,11,15,"enumerable"],[1,144,11,15],[1,146,11,15,"get"],[1,150,11,15],[1,168,11,15,"RealtimePresence"],[1,169,11,15],[1,173,5,0,"Object"],[1,180,5,0,"defineProperty"],[1,195,5,0,"e"],[1,197,5,0],[1,232,5,0,"enumerable"],[1,244,5,0],[1,246,5,0,"get"],[1,250,5,0],[1,268,5,0,"REALTIME_PRESENCE_LISTEN_EVENTS"],[1,269,5,0],[1,274,6,0],[1,283,6,11,"REALTIME_PRESENCE_LISTEN_EVENTS"],[1,286,7,4,"REALTIME_PRESENCE_LISTEN_EVENTS"],[1,288,7,42],[1,293,7,46],[1,300,8,4,"REALTIME_PRESENCE_LISTEN_EVENTS"],[1,302,8,42],[1,307,8,46],[1,314,9,4,"REALTIME_PRESENCE_LISTEN_EVENTS"],[1,316,9,43],[1,322,9,47],[1,329,10,1],[1,331,6,0],[1,332,10,3,"REALTIME_PRESENCE_LISTEN_EVENTS"],[1,336,10,39,"REALTIME_PRESENCE_LISTEN_EVENTS"],[1,338,10,73],[1,339,10,74],[1,343,11,15],[1,349,11,21,"RealtimePresence"],[1,351,27,4,"constructor"],[1,363,27,16,"channel"],[1,365,27,25,"opts"],[1,368,28,8,"this"],[1,373,28,13,"channel"],[1,381,28,23,"channel"],[1,383,29,8,"this"],[1,388,29,13,"state"],[1,394,29,21],[1,395,29,22],[1,397,30,8,"this"],[1,402,30,13,"pendingDiffs"],[1,415,30,28],[1,418,31,8,"this"],[1,423,31,13,"joinRef"],[1,431,31,23],[1,436,32,8,"this"],[1,441,32,13,"enabled"],[1,450,32,23],[1,452,33,8,"this"],[1,457,33,13,"caller"],[1,464,33,22],[1,465,34,12,"onJoin"],[1,472,34,20,"onJoin"],[1,479,35,12,"onLeave"],[1,487,35,21,"onLeave"],[1,494,36,12,"onSync"],[1,501,36,20,"onSync"],[1,509,38,8],[1,515,38,14,"events"],[1,518,38,24,"opts"],[1,531,38,56,"undefined"],[1,533,38,68,"opts"],[1,535,38,73,"events"],[1,544,38,84],[1,545,39,12,"state"],[1,551,39,19],[1,568,40,12,"diff"],[1,573,40,18],[1,590,42,8,"this"],[1,595,42,13,"channel"],[1,603,42,21,"_on"],[1,607,42,25,"events"],[1,609,42,32,"state"],[1,615,42,39],[1,616,42,40],[1,618,42,44,"newState"],[1,622,43,12],[1,628,43,18,"onJoin"],[1,635,43,20,"onJoin"],[1,637,43,26,"onLeave"],[1,645,43,28,"onLeave"],[1,647,43,35,"onSync"],[1,654,43,37,"onSync"],[1,657,43,48,"this"],[1,662,43,53,"caller"],[1,669,44,12,"this"],[1,674,44,17,"joinRef"],[1,682,44,27,"this"],[1,687,44,32,"channel"],[1,695,44,40,"_joinRef"],[1,706,45,12,"this"],[1,711,45,17,"state"],[1,717,45,25,"RealtimePresence"],[1,719,45,42,"syncState"],[1,729,45,52,"this"],[1,734,45,57,"state"],[1,740,45,64,"newState"],[1,742,45,74,"onJoin"],[1,744,45,82,"onLeave"],[1,747,46,12,"this"],[1,752,46,17,"pendingDiffs"],[1,765,46,30,"forEach"],[1,773,46,39,"diff"],[1,777,47,16,"this"],[1,782,47,21,"state"],[1,788,47,29,"RealtimePresence"],[1,790,47,46,"syncDiff"],[1,799,47,55,"this"],[1,804,47,60,"state"],[1,810,47,67,"diff"],[1,812,47,73,"onJoin"],[1,814,47,81,"onLeave"],[1,819,49,12,"this"],[1,824,49,17,"pendingDiffs"],[1,837,49,32],[1,840,50,12,"onSync"],[1,846,52,8,"this"],[1,851,52,13,"channel"],[1,859,52,21,"_on"],[1,863,52,25,"events"],[1,865,52,32,"diff"],[1,870,52,38],[1,871,52,39],[1,873,52,43,"diff"],[1,877,53,12],[1,883,53,18,"onJoin"],[1,890,53,20,"onJoin"],[1,892,53,26,"onLeave"],[1,900,53,28,"onLeave"],[1,902,53,35,"onSync"],[1,909,53,37,"onSync"],[1,912,53,48,"this"],[1,917,53,53,"caller"],[1,924,54,16,"this"],[1,929,54,21,"inPendingSyncState"],[1,950,55,16,"this"],[1,955,55,21,"pendingDiffs"],[1,968,55,34,"push"],[1,973,55,39,"diff"],[1,977,58,16,"this"],[1,982,58,21,"state"],[1,988,58,29,"RealtimePresence"],[1,990,58,46,"syncDiff"],[1,999,58,55,"this"],[1,1004,58,60,"state"],[1,1010,58,67,"diff"],[1,1012,58,73,"onJoin"],[1,1014,58,81,"onLeave"],[1,1017,59,16,"onSync"],[1,1024,62,8,"this"],[1,1029,62,13,"onJoin"],[1,1036,62,20],[1,1037,62,21,"key"],[1,1039,62,26,"currentPresences"],[1,1041,62,44,"newPresences"],[1,1046,63,12,"this"],[1,1051,63,17,"channel"],[1,1059,63,25,"_trigger"],[1,1068,63,34],[1,1079,63,46],[1,1080,64,16,"event"],[1,1086,64,23],[1,1093,65,16,"key"],[1,1099,66,16,"currentPresences"],[1,1118,67,16,"newPresences"],[1,1137,70,8,"this"],[1,1142,70,13,"onLeave"],[1,1150,70,21],[1,1151,70,22,"key"],[1,1153,70,27,"currentPresences"],[1,1155,70,45,"leftPresences"],[1,1160,71,12,"this"],[1,1165,71,17,"channel"],[1,1173,71,25,"_trigger"],[1,1182,71,34],[1,1193,71,46],[1,1194,72,16,"event"],[1,1200,72,23],[1,1208,73,16,"key"],[1,1214,74,16,"currentPresences"],[1,1233,75,16,"leftPresences"],[1,1253,78,8,"this"],[1,1258,78,13,"onSync"],[1,1265,78,20],[1,1270,79,12,"this"],[1,1275,79,17,"channel"],[1,1283,79,25,"_trigger"],[1,1292,79,34],[1,1303,79,46],[1,1304,79,48,"event"],[1,1310,79,55],[1,1320,81,4],[1,1321,92,4],[1,1337,92,11,"syncState"],[1,1338,92,21,"currentState"],[1,1340,92,35,"newState"],[1,1342,92,45,"onJoin"],[1,1344,92,53,"onLeave"],[1,1347,93,8],[1,1353,93,14,"state"],[1,1355,93,22,"this"],[1,1360,93,27,"cloneDeep"],[1,1370,93,37,"currentState"],[1,1373,94,14,"transformedState"],[1,1375,94,33,"this"],[1,1380,94,38,"transformState"],[1,1395,94,53,"newState"],[1,1398,95,14,"joins"],[1,1400,95,22],[1,1401,95,23],[1,1403,96,14,"leaves"],[1,1405,96,23],[1,1406,96,24],[1,1408,120,8],[1,1415,97,8,"this"],[1,1420,97,13,"map"],[1,1424,97,17,"state"],[1,1426,97,24],[1,1427,97,25,"key"],[1,1429,97,30,"presences"],[1,1434,98,17,"transformedState"],[1,1436,98,34,"key"],[1,1441,99,16,"leaves"],[1,1443,99,23,"key"],[1,1446,99,30,"presences"],[1,1451,102,8,"this"],[1,1456,102,13,"map"],[1,1460,102,17,"transformedState"],[1,1462,102,35],[1,1463,102,36,"key"],[1,1465,102,41,"newPresences"],[1,1470,103,12],[1,1476,103,18,"currentPresences"],[1,1478,103,37,"state"],[1,1480,103,43,"key"],[1,1483,104,12],[1,1486,104,16,"currentPresences"],[1,1488,104,34],[1,1489,105,16],[1,1495,105,22,"newPresenceRefs"],[1,1497,105,40,"newPresences"],[1,1499,105,53,"map"],[1,1503,105,58,"m"],[1,1506,105,64,"m"],[1,1508,105,66,"presence_ref"],[1,1522,106,22,"curPresenceRefs"],[1,1524,106,40,"currentPresences"],[1,1526,106,57,"map"],[1,1530,106,62,"m"],[1,1533,106,68,"m"],[1,1535,106,70,"presence_ref"],[1,1549,107,22,"joinedPresences"],[1,1551,107,40,"newPresences"],[1,1553,107,53,"filter"],[1,1560,107,61,"m"],[1,1563,107,67,"curPresenceRefs"],[1,1565,107,83,"indexOf"],[1,1573,107,91,"m"],[1,1575,107,93,"presence_ref"],[1,1589,107,109],[1,1592,108,22,"leftPresences"],[1,1594,108,38,"currentPresences"],[1,1596,108,55,"filter"],[1,1603,108,63,"m"],[1,1606,108,69,"newPresenceRefs"],[1,1608,108,85,"indexOf"],[1,1616,108,93,"m"],[1,1618,108,95,"presence_ref"],[1,1632,108,111],[1,1635,109,20,"joinedPresences"],[1,1637,109,36,"length"],[1,1644,109,45],[1,1648,110,20,"joins"],[1,1650,110,26,"key"],[1,1653,110,33,"joinedPresences"],[1,1656,112,20,"leftPresences"],[1,1658,112,34,"length"],[1,1665,112,43],[1,1669,113,20,"leaves"],[1,1671,113,27,"key"],[1,1674,113,34,"leftPresences"],[1,1676,115,12],[1,1682,117,16,"joins"],[1,1684,117,22,"key"],[1,1687,117,29,"newPresences"],[1,1691,120,15,"this"],[1,1696,120,20,"syncDiff"],[1,1705,120,29,"state"],[1,1707,120,36],[1,1708,120,38,"joins"],[1,1716,120,45,"leaves"],[1,1726,120,55,"onJoin"],[1,1728,120,63,"onLeave"],[1,1730,121,4],[1,1731,132,4],[1,1746,132,11,"syncDiff"],[1,1747,132,20,"state"],[1,1749,132,27,"diff"],[1,1751,132,33,"onJoin"],[1,1753,132,41,"onLeave"],[1,1756,133,8],[1,1762,133,14,"joins"],[1,1768,133,16,"joins"],[1,1770,133,21,"leaves"],[1,1777,133,23,"leaves"],[1,1780,133,34],[1,1781,134,12,"joins"],[1,1787,134,19,"this"],[1,1792,134,24,"transformState"],[1,1807,134,39,"diff"],[1,1809,134,44,"joins"],[1,1816,135,12,"leaves"],[1,1823,135,20,"this"],[1,1828,135,25,"transformState"],[1,1843,135,40,"diff"],[1,1845,135,45,"leaves"],[1,1854,165,8],[1,1861,137,13,"onJoin"],[1,1865,138,12,"onJoin"],[1,1867,138,21,"onJoin"],[1,1875,140,13,"onLeave"],[1,1879,141,12,"onLeave"],[1,1881,141,22,"onLeave"],[1,1889,143,8,"this"],[1,1894,143,13,"map"],[1,1898,143,17,"joins"],[1,1900,143,24],[1,1901,143,25,"key"],[1,1903,143,30,"newPresences"],[1,1908,144,12],[1,1912,144,16,"_a"],[1,1914,145,12],[1,1920,145,18,"currentPresences"],[1,1922,145,59],[1,1930,145,38,"_a"],[1,1932,145,43,"state"],[1,1934,145,49,"key"],[1,1944,145,69,"undefined"],[1,1948,145,67,"_a"],[1,1950,145,83,"_a"],[1,1952,145,88],[1,1955,147,12],[1,1958,146,12,"state"],[1,1960,146,18,"key"],[1,1963,146,25,"this"],[1,1968,146,30,"cloneDeep"],[1,1978,146,40,"newPresences"],[1,1981,147,16,"currentPresences"],[1,1983,147,33,"length"],[1,1990,147,42],[1,1992,147,45],[1,1993,148,16],[1,1999,148,22,"joinedPresenceRefs"],[1,2001,148,43,"state"],[1,2003,148,49,"key"],[1,2006,148,54,"map"],[1,2010,148,59,"m"],[1,2013,148,65,"m"],[1,2015,148,67,"presence_ref"],[1,2029,149,22,"curPresences"],[1,2031,149,37,"currentPresences"],[1,2033,149,54,"filter"],[1,2040,149,62,"m"],[1,2043,149,68,"joinedPresenceRefs"],[1,2045,149,87,"indexOf"],[1,2053,149,95,"m"],[1,2055,149,97,"presence_ref"],[1,2069,149,113],[1,2072,150,16,"state"],[1,2074,150,22,"key"],[1,2077,150,27,"unshift"],[1,2088,150,38,"curPresences"],[1,2090,151,12],[1,2091,152,12,"onJoin"],[1,2093,152,19,"key"],[1,2095,152,24,"currentPresences"],[1,2097,152,42,"newPresences"],[1,2102,154,8,"this"],[1,2107,154,13,"map"],[1,2111,154,17,"leaves"],[1,2113,154,25],[1,2114,154,26,"key"],[1,2116,154,31,"leftPresences"],[1,2121,155,12],[1,2125,155,16,"currentPresences"],[1,2127,155,35,"state"],[1,2129,155,41,"key"],[1,2132,156,12],[1,2136,156,17,"currentPresences"],[1,2138,157,16],[1,2145,158,12],[1,2151,158,18,"presenceRefsToRemove"],[1,2153,158,41,"leftPresences"],[1,2155,158,55,"map"],[1,2159,158,60,"m"],[1,2162,158,66,"m"],[1,2164,158,68,"presence_ref"],[1,2178,159,12,"currentPresences"],[1,2180,159,31,"currentPresences"],[1,2182,159,48,"filter"],[1,2189,159,56,"m"],[1,2192,159,62,"presenceRefsToRemove"],[1,2194,159,83,"indexOf"],[1,2202,159,91,"m"],[1,2204,159,93,"presence_ref"],[1,2218,159,109],[1,2221,160,12,"state"],[1,2223,160,18,"key"],[1,2226,160,25,"currentPresences"],[1,2228,161,12,"onLeave"],[1,2230,161,20,"key"],[1,2232,161,25,"currentPresences"],[1,2234,161,43,"leftPresences"],[1,2237,162,44],[1,2241,162,16,"currentPresences"],[1,2243,162,33,"length"],[1,2258,163,23,"state"],[1,2260,163,29,"key"],[1,2265,165,15,"state"],[1,2266,166,4],[1,2267,168,4],[1,2277,168,11,"map"],[1,2278,168,15,"obj"],[1,2280,168,20,"func"],[1,2283,169,8],[1,2290,169,15,"Object"],[1,2297,169,22,"getOwnPropertyNames"],[1,2317,169,42,"obj"],[1,2320,169,47,"map"],[1,2324,169,52,"key"],[1,2327,169,60,"func"],[1,2329,169,65,"key"],[1,2331,169,70,"obj"],[1,2333,169,74,"key"],[1,2337,170,4],[1,2338,194,4],[1,2359,194,11,"transformState"],[1,2360,194,26,"state"],[1,2363,196,8],[1,2370,195,8,"state"],[1,2372,195,16,"this"],[1,2377,195,21,"cloneDeep"],[1,2387,195,31,"state"],[1,2390,196,15,"Object"],[1,2397,196,22,"getOwnPropertyNames"],[1,2417,196,42,"state"],[1,2420,196,49,"reduce"],[1,2427,196,56],[1,2428,196,57,"newState"],[1,2430,196,67,"key"],[1,2435,197,12],[1,2441,197,18,"presences"],[1,2443,197,30,"state"],[1,2445,197,36,"key"],[1,2448,209,12],[1,2455,199,16,"newState"],[1,2457,199,25,"key"],[1,2460,198,16],[1,2470,198,27,"presences"],[1,2472,199,32,"presences"],[1,2474,199,42,"metas"],[1,2480,199,48,"map"],[1,2484,199,53,"presence"],[1,2488,200,20,"presence"],[1,2490,200,43],[1,2503,200,47,"presence"],[1,2505,200,65],[1,2520,201,27,"presence"],[1,2522,201,45],[1,2537,202,27,"presence"],[1,2539,202,50],[1,2552,203,27,"presence"],[1,2556,207,32,"presences"],[1,2558,209,19,"newState"],[1,2561,210,11],[1,2562,210,12],[1,2564,211,4],[1,2565,213,4],[1,2581,213,11,"cloneDeep"],[1,2582,213,21,"obj"],[1,2585,214,8],[1,2592,214,15,"JSON"],[1,2597,214,20,"parse"],[1,2603,214,26,"JSON"],[1,2608,214,31,"stringify"],[1,2618,214,41,"obj"],[1,2621,215,4],[1,2622,217,4,"onJoin"],[1,2629,217,11,"callback"],[1,2632,218,8,"this"],[1,2637,218,13,"caller"],[1,2644,218,20,"onJoin"],[1,2651,218,29,"callback"],[1,2652,219,4],[1,2653,221,4,"onLeave"],[1,2661,221,12,"callback"],[1,2664,222,8,"this"],[1,2669,222,13,"caller"],[1,2676,222,20,"onLeave"],[1,2684,222,30,"callback"],[1,2685,223,4],[1,2686,225,4,"onSync"],[1,2693,225,11,"callback"],[1,2696,226,8,"this"],[1,2701,226,13,"caller"],[1,2708,226,20,"onSync"],[1,2715,226,29,"callback"],[1,2716,227,4],[1,2717,229,4,"inPendingSyncState"],[1,2738,230,8],[1,2745,230,16,"this"],[1,2750,230,21,"joinRef"],[1,2759,230,32,"this"],[1,2764,230,37,"joinRef"],[1,2774,230,49,"this"],[1,2779,230,54,"channel"],[1,2787,230,62,"_joinRef"],[1,2797,231,4],[1,2799,232,1],[1,2802]],"functionMap":{"names":["<global>","<anonymous>","RealtimePresence","constructor","caller.onJoin","caller.onLeave","caller.onSync","channel._on$argument_2","pendingDiffs.forEach$argument_0","onJoin$argument_0","onLeave$argument_0","onSync$argument_0","syncState","map$argument_1","newPresences.map$argument_0","currentPresences.map$argument_0","newPresences.filter$argument_0","currentPresences.filter$argument_0","syncDiff","onJoin","onLeave","state.key.map$argument_0","leftPresences.map$argument_0","map","Object.getOwnPropertyNames.map$argument_0","transformState","Object.getOwnPropertyNames.reduce$argument_0","presences.metas.map$argument_0","cloneDeep","onSync","inPendingSyncState"],"mappings":"AAA;CCK;CDI;eEC;ICgB;oBCO,SD;qBEC,SF;oBGC,SH;2CIM;sCCI;aDE;SJG;0CIC;SJS;oBMC;SNO;qBOC;SPO;oBQC;SRE;KDC;IUW;wBCK;SDI;mCCC;yDCG,qBD;6DEC,qBF;4DGC,kDH;8DIC,kDJ;SDW;KVE;IgBW;qBCM,SD;sBEG,SF;wBLE;0DQK,qBR;6DIC,qDJ;SKI;yBLC;2DSI,qBT;uDIC,uDJ;SKK;KhBE;IqBE;mDCC,4BD;KrBC;IuBwB;wDCE;oDCG;iBDK;SDM;KvBC;I0BE;K1BE;IiBE;KjBE;IkBE;KlBE;I2BE;K3BE;I4BE;K5BE;CFC"},"hasCjsExports":false},"type":"js/module"}]}