{"dependencies":[{"name":"../lib/constants","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":20,"index":97},"end":{"line":3,"column":47,"index":124}}],"key":"5SaJjHUOpKrE3J3aWh2RTsVAt6s=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function(g,r,i,a,m,e,d){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const t=r(d[0]);e.default=class{constructor(s,h,n={},c=t.DEFAULT_TIMEOUT){this.channel=s,this.event=h,this.payload=n,this.timeout=c,this.sent=!1,this.timeoutTimer=void 0,this.ref='',this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref='',this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived('timeout')||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,s){var h;return this._hasReceived(t)&&s(null===(h=this.receivedResp)||void 0===h?void 0:h.response),this.recHooks.push({status:t,callback:s}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)}),this.timeoutTimer=setTimeout(()=>{this.trigger('timeout',{})},this.timeout)}trigger(t,s){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:s})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:s}){this.recHooks.filter(s=>s.status===t).forEach(t=>t.callback(s))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}});","lineCount":1,"map":[[1,28,1,0],[1,41,2,0,"Object"],[1,48,2,7,"defineProperty"],[1,63,2,22,"exports"],[1,65,2,31],[1,78,2,45],[1,79,2,47,"value"],[1,86,2,54],[1,90,3,0],[1,96,3,6,"constants_1"],[1,98,3,20,"require"],[1,100,3,27,"d"],[1,102,3,27],[1,106,101,0,"exports"],[1,108,101,8,"default"],[1,116,4,0],[1,122,13,4,"constructor"],[1,134,13,16,"channel"],[1,136,13,25,"event"],[1,138,13,32,"payload"],[1,140,13,42],[1,141,13,43],[1,143,13,46,"timeout"],[1,145,13,56,"constants_1"],[1,147,13,68,"DEFAULT_TIMEOUT"],[1,164,14,8,"this"],[1,169,14,13,"channel"],[1,177,14,23,"channel"],[1,179,15,8,"this"],[1,184,15,13,"event"],[1,190,15,21,"event"],[1,192,16,8,"this"],[1,197,16,13,"payload"],[1,205,16,23,"payload"],[1,207,17,8,"this"],[1,212,17,13,"timeout"],[1,220,17,23,"timeout"],[1,222,18,8,"this"],[1,227,18,13,"sent"],[1,233,18,20],[1,235,19,8,"this"],[1,240,19,13,"timeoutTimer"],[1,258,19,28,"undefined"],[1,260,20,8,"this"],[1,265,20,13,"ref"],[1,269,20,19],[1,272,21,8,"this"],[1,277,21,13,"receivedResp"],[1,290,21,28],[1,295,22,8,"this"],[1,300,22,13,"recHooks"],[1,309,22,24],[1,312,23,8,"this"],[1,317,23,13,"refEvent"],[1,326,23,24],[1,330,24,4],[1,331,25,4,"resend"],[1,338,25,11,"timeout"],[1,341,26,8,"this"],[1,346,26,13,"timeout"],[1,354,26,23,"timeout"],[1,356,27,8,"this"],[1,361,27,13,"_cancelRefEvent"],[1,379,28,8,"this"],[1,384,28,13,"ref"],[1,388,28,19],[1,391,29,8,"this"],[1,396,29,13,"refEvent"],[1,405,29,24],[1,410,30,8,"this"],[1,415,30,13,"receivedResp"],[1,428,30,28],[1,433,31,8,"this"],[1,438,31,13,"sent"],[1,444,31,20],[1,446,32,8,"this"],[1,451,32,13,"send"],[1,457,33,4],[1,458,34,4,"send"],[1,465,35,12,"this"],[1,470,35,17,"_hasReceived"],[1,483,35,30],[1,496,38,8,"this"],[1,501,38,13,"startTimeout"],[1,516,39,8,"this"],[1,521,39,13,"sent"],[1,527,39,20],[1,529,40,8,"this"],[1,534,40,13,"channel"],[1,542,40,21,"socket"],[1,549,40,28,"push"],[1,554,40,33],[1,555,41,12,"topic"],[1,561,41,19,"this"],[1,566,41,24,"channel"],[1,574,41,32,"topic"],[1,580,42,12,"event"],[1,586,42,19,"this"],[1,591,42,24,"event"],[1,597,43,12,"payload"],[1,605,43,21,"this"],[1,610,43,26,"payload"],[1,618,44,12,"ref"],[1,622,44,17,"this"],[1,627,44,22,"ref"],[1,631,45,12,"join_ref"],[1,640,45,22,"this"],[1,645,45,27,"channel"],[1,653,45,35,"_joinRef"],[1,666,47,4],[1,667,48,4,"updatePayload"],[1,681,48,18,"payload"],[1,684,49,8,"this"],[1,689,49,13,"payload"],[1,697,49,23,"Object"],[1,704,49,30,"assign"],[1,711,49,37,"Object"],[1,718,49,44,"assign"],[1,725,49,51],[1,726,49,52],[1,728,49,55,"this"],[1,733,49,60,"payload"],[1,742,49,70,"payload"],[1,744,50,4],[1,745,51,4,"receive"],[1,753,51,12,"status"],[1,755,51,20,"callback"],[1,758,52,8],[1,762,52,12,"_a"],[1,764,57,8],[1,771,53,12,"this"],[1,776,53,17,"_hasReceived"],[1,789,53,30,"status"],[1,793,54,12,"callback"],[1,795,54,50],[1,803,54,22,"_a"],[1,805,54,27,"this"],[1,810,54,32,"receivedResp"],[1,830,54,60,"undefined"],[1,834,54,58,"_a"],[1,841,54,71,"undefined"],[1,843,54,83,"_a"],[1,845,54,86,"response"],[1,855,56,8,"this"],[1,860,56,13,"recHooks"],[1,869,56,22,"push"],[1,874,56,27],[1,875,56,29,"status"],[1,884,56,37,"callback"],[1,897,57,15,"this"],[1,901,58,4],[1,902,59,4,"startTimeout"],[1,917,60,8],[1,920,60,12,"this"],[1,925,60,17,"timeoutTimer"],[1,938,61,12],[1,945,63,8,"this"],[1,950,63,13,"ref"],[1,954,63,19,"this"],[1,959,63,24,"channel"],[1,967,63,32,"socket"],[1,974,63,39,"_makeRef"],[1,985,64,8,"this"],[1,990,64,13,"refEvent"],[1,999,64,24,"this"],[1,1004,64,29,"channel"],[1,1012,64,37,"_replyEventName"],[1,1028,64,53,"this"],[1,1033,64,58,"ref"],[1,1038,71,8,"this"],[1,1043,71,13,"channel"],[1,1051,71,21,"_on"],[1,1055,71,25,"this"],[1,1060,71,30,"refEvent"],[1,1069,71,40],[1,1070,71,41],[1,1072,65,26,"payload"],[1,1076,66,12,"this"],[1,1081,66,17,"_cancelRefEvent"],[1,1099,67,12,"this"],[1,1104,67,17,"_cancelTimeout"],[1,1121,68,12,"this"],[1,1126,68,17,"receivedResp"],[1,1139,68,32,"payload"],[1,1141,69,12,"this"],[1,1146,69,17,"_matchReceive"],[1,1160,69,31,"payload"],[1,1165,72,8,"this"],[1,1170,72,13,"timeoutTimer"],[1,1183,72,28,"setTimeout"],[1,1194,72,39],[1,1199,73,12,"this"],[1,1204,73,17,"trigger"],[1,1212,73,25],[1,1222,73,36],[1,1223,73,37],[1,1227,74,11,"this"],[1,1232,74,16,"timeout"],[1,1240,75,4],[1,1241,76,4,"trigger"],[1,1249,76,12,"status"],[1,1251,76,20,"response"],[1,1254,77,12,"this"],[1,1259,77,17,"refEvent"],[1,1269,78,12,"this"],[1,1274,78,17,"channel"],[1,1282,78,25,"_trigger"],[1,1291,78,34,"this"],[1,1296,78,39,"refEvent"],[1,1305,78,49],[1,1306,78,51,"status"],[1,1315,78,59,"response"],[1,1327,79,4],[1,1328,80,4,"destroy"],[1,1338,81,8,"this"],[1,1343,81,13,"_cancelRefEvent"],[1,1361,82,8,"this"],[1,1366,82,13,"_cancelTimeout"],[1,1382,83,4],[1,1383,84,4,"_cancelRefEvent"],[1,1401,85,13,"this"],[1,1406,85,18,"refEvent"],[1,1416,88,8,"this"],[1,1421,88,13,"channel"],[1,1429,88,21,"_off"],[1,1434,88,26,"this"],[1,1439,88,31,"refEvent"],[1,1448,88,41],[1,1449,88,42],[1,1451,89,4],[1,1452,90,4,"_cancelTimeout"],[1,1469,91,8,"clearTimeout"],[1,1482,91,21,"this"],[1,1487,91,26,"timeoutTimer"],[1,1501,92,8,"this"],[1,1506,92,13,"timeoutTimer"],[1,1524,92,28,"undefined"],[1,1525,93,4],[1,1526,94,4,"_matchReceive"],[1,1541,94,18,"status"],[1,1548,94,20,"status"],[1,1550,94,26,"response"],[1,1559,94,28,"response"],[1,1563,95,8,"this"],[1,1568,95,13,"recHooks"],[1,1577,95,22,"filter"],[1,1584,95,30,"h"],[1,1587,95,36,"h"],[1,1589,95,38,"status"],[1,1598,95,49,"status"],[1,1601,95,57,"forEach"],[1,1609,95,66,"h"],[1,1612,95,72,"h"],[1,1614,95,74,"callback"],[1,1623,95,83,"response"],[1,1626,96,4],[1,1627,97,4,"_hasReceived"],[1,1640,97,17,"status"],[1,1643,98,8],[1,1650,98,15,"this"],[1,1655,98,20,"receivedResp"],[1,1669,98,36,"this"],[1,1674,98,41,"receivedResp"],[1,1687,98,54,"status"],[1,1696,98,65,"status"],[1,1697,99,4],[1,1699,101,23],[1,1702]],"functionMap":{"names":["<global>","Push","Push#constructor","Push#resend","Push#send","Push#updatePayload","Push#receive","Push#startTimeout","callback","setTimeout$argument_0","Push#trigger","Push#destroy","Push#_cancelRefEvent","Push#_cancelTimeout","Push#_matchReceive","recHooks.filter$argument_0","recHooks.filter.forEach$argument_0","Push#_hasReceived"],"mappings":"AAA;ACG;ICS;KDW;IEC;KFQ;IGC;KHa;IIC;KJE;IKC;KLO;IMC;yBCM;SDK;uCEE;SFE;KNC;ISC;KTG;IUC;KVG;IWC;KXK;IYC;KZG;IaC;6BCC,0BD,UE,2BF;KbC;IgBC;KhBE;CDC"},"hasCjsExports":true},"type":"js/module"}]}